<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Di√°rio de Bordo Profissional</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --primary-color: #2c3e50; /* Azul Marinho Corporativo */
            --accent-color: #3498db; /* Azul Brilhante para A√ß√µes */
            --dark-color: #222;
            --light-color: #f4f6f8; /* Fundo geral */
            --gray-color: #7f8c8d;
            --white-color: #ffffff;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --border-color: #dfe4ea;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-headings: 'Lato', var(--font-main);
        }
        @keyframes pulse { 50% { opacity: .5; } }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; }
        body { font-family: var(--font-main); background-color: var(--light-color); color: var(--dark-color); line-height: 1.6; }
        
        .main-container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }

        /* --- Tela de Acesso Negado --- */
        #auth-container { display: none; align-items: center; justify-content: center; height: 100%; text-align: center; }
        .auth-box { background: var(--white-color); padding: 40px; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
        .auth-box h1 { color: var(--danger-color); }
        .auth-box p { color: var(--gray-color); margin-top: 10px; }

        /* --- App Header --- */
        #app-header { background: var(--white-color); padding: 15px 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        #app-header h1 { color: var(--primary-color); font-size: 1.8em; margin: 0; }
        #user-info { display: flex; align-items: center; gap: 15px; }
        #user-email { color: var(--gray-color); font-size: 0.9em; font-weight: 500; }
        #logout-btn { background: var(--danger-color); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: 600; }

        /* --- Skeleton Loader --- */
        #loader-container { display: block; }
        .skeleton { background-color: #e0e0e0; border-radius: 8px; animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .skeleton-header { height: 74px; margin-bottom: 20px; }
        .skeleton-nav { height: 40px; width: 300px; margin: 0 auto 25px auto;}
        .skeleton-box { min-height: 450px; }

        /* --- Estilos do Di√°rio --- */
        .daily-wrapper { display: grid; grid-template-columns: 1fr; gap: 30px; }
        @media (min-width: 900px) { .daily-wrapper { grid-template-columns: 1fr 1fr; } }
        header.date-header { text-align: center; margin-bottom: 25px; }
        .date-navigation { display: flex; align-items: center; justify-content: center; gap: 15px; }
        .nav-btn { background: none; border: none; font-size: 2.2em; cursor: pointer; color: var(--primary-color); padding: 0 10px; transition: color 0.2s; }
        .nav-btn:disabled { color: #bdc3c7; cursor: not-allowed; }
        #currentDate { font-size: 1.3em; color: var(--primary-color); font-weight: 600; }
        .section-box { border: 1px solid var(--border-color); border-radius: 12px; padding: 25px; background-color: var(--white-color); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .section-box h2 { font-family: var(--font-headings); font-size: 1.6em; color: var(--primary-color); border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; }
        .form-section { margin-bottom: 20px; }
        .form-section label { display: block; font-weight: 600; margin-bottom: 8px; color: #444; }
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1em; }
        textarea { min-height: 100px; resize: vertical; }
        .button-container { text-align: center; margin-top: 25px; }
        .btn-action { background-color: var(--accent-color); color: var(--white-color); border: none; padding: 12px 25px; border-radius: 8px; font-size: 1.05em; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
        .btn-action:hover { background-color: #2980b9; }
        footer { text-align: center; margin-top: 40px; color: var(--gray-color); font-size: 0.9em; padding: 20px 0; }
    </style>
</head>
<body>
    <div id="auth-container">
        <div class="auth-box">
            <h1>Acesso Negado</h1>
            <p>Sua sess√£o √© inv√°lida ou expirou. Por favor, retorne √† plataforma e fa√ßa login novamente.</p>
        </div>
    </div>

    <div id="loader-container" class="main-container">
        <div class="skeleton skeleton-header"></div>
        <div class="skeleton skeleton-nav"></div>
        <div class="daily-wrapper">
            <div class="skeleton skeleton-box"></div>
            <div class="skeleton skeleton-box"></div>
        </div>
    </div>

    <div id="app-container" class="main-container" style="display: none;">
        <header id="app-header">
            <h1>Di√°rio de Bordo Profissional</h1>
            <div id="user-info">
                <span id="user-email"></span>
                <button id="logout-btn">Sair</button>
            </div>
        </header>

        <main>
            <header class="date-header">
                <div class="date-navigation">
                    <button id="prevDayBtn" class="nav-btn">&lt;</button>
                    <p id="currentDate"></p>
                    <button id="nextDayBtn" class="nav-btn">&gt;</button>
                </div>
            </header>
            
            <div class="daily-wrapper">
                <div id="planningBox" class="section-box">
                    <h2>Planejamento do Dia</h2>
                    <form id="planningForm">
                         <div class="form-section"><label for="dailyFocus">Foco Principal do Dia</label><input type="text" id="dailyFocus" placeholder="Ex: Avan√ßar 20% no relat√≥rio de vendas trimestral."></div>
                         <div class="form-section"><label for="criticalTasks">Prioridades (Sua atua√ß√£o direta)</label><textarea id="criticalTasks" rows="3" placeholder="Ex: Alinhar escopo do projeto Y com o Diretor."></textarea></div>
                    </form>
                </div>
                <div id="reviewBox" class="section-box">
                    <h2>Revis√£o e Fechamento do Dia</h2>
                    <form id="reviewForm">
                        <div class="form-section"><label for="mainAchievement">Principal Conquista</label><input type="text" id="mainAchievement" placeholder="Qual foi o maior avan√ßo de hoje?"></div>
                        <div class="form-section"><label for="mainChallenge">Principal Desafio/Aprendizado</label><input type="text" id="mainChallenge" placeholder="O que te bloqueou ou o que voc√™ aprendeu?"></div>
                    </form>
                    <div class="button-container">
                        <button type="button" id="saveDayBtn" class="btn-action">Salvar Dia</button>
                    </div>
                </div>
            </div>
        </main>
        
        <footer><p>Desenvolvido com ü§ñ por thIAguinho Solu√ß√µes</p></footer>
    </div>

    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyAo9iVQm_BzmvNLAUxc4pGL_qp6ic4JQfo",
        authDomain: "listas-de-compras-ff4a3.firebaseapp.com",
        databaseURL: "https://listas-de-compras-ff4a3-default-rtdb.firebaseio.com",
        projectId: "listas-de-compras-ff4a3",
        storageBucket: "listas-de-compras-ff4a3.firebasestorage.app",
        messagingSenderId: "623752672529",
        appId: "1:623752672529:web:ba43bfdad31f050da3c8b0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    document.addEventListener('DOMContentLoaded', () => {
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const loaderContainer = document.getElementById('loader-container');
        const logoutBtn = document.getElementById('logout-btn');

        const App = {
            data: {},
            currentUser: null,
            displayedDate: new Date(),
            today: new Date(),

            init() {
                this.today.setHours(0, 0, 0, 0);
                this.displayedDate.setHours(0, 0, 0, 0);
                this.addAuthListeners();
                this.addEventListeners();
            },

            showView(view) {
                loaderContainer.style.display = view === 'loader' ? 'block' : 'none';
                authContainer.style.display = view === 'auth' ? 'flex' : 'none';
                appContainer.style.display = view === 'app' ? 'block' : 'none';
            },

            addAuthListeners() {
                auth.onAuthStateChanged(user => {
                    if (user) {
                        if (!this.currentUser) { // Apenas carrega na primeira vez que o usu√°rio √© detectado
                            this.showView('loader');
                            this.currentUser = user;
                            document.getElementById('user-email').textContent = user.email;
                            this.loadDayData(this.getDateString(this.displayedDate));
                        }
                    } else {
                        this.currentUser = null;
                        this.showView('auth');
                    }
                });

                logoutBtn.addEventListener('click', () => {
                    auth.signOut().catch(error => console.error("Erro ao fazer logout:", error));
                });
            },

            getDateString: date => date.toISOString().split('T')[0],

            async loadDayData(dateString) {
                if (!this.currentUser) return;
                this.showView('loader');
                // CAMINHO ADAPTADO PARA AS REGRAS FORNECIDAS
                const dataRef = database.ref(`easy_lists/${this.currentUser.uid}/diario_de_bordo/${dateString}`);
                try {
                    const snapshot = await dataRef.once('value');
                    this.data[dateString] = snapshot.val();
                    this.renderDay(dateString);
                } catch (error) {
                    console.error("Erro ao carregar dados do Firebase:", error);
                    alert("N√£o foi poss√≠vel carregar os dados. Verifique as regras de seguran√ßa do seu banco de dados.");
                } finally {
                   this.showView('app');
                }
            },

            renderDay(dateString) {
                document.getElementById('currentDate').textContent = this.displayedDate.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
                document.getElementById('nextDayBtn').disabled = this.getDateString(this.displayedDate) === this.getDateString(this.today);
                
                const dayData = this.data[dateString];
                
                document.getElementById('dailyFocus').value = dayData?.plan?.dailyFocus || '';
                document.getElementById('criticalTasks').value = dayData?.plan?.criticalTasks || '';
                document.getElementById('mainAchievement').value = dayData?.review?.mainAchievement || '';
                document.getElementById('mainChallenge').value = dayData?.review?.mainChallenge || '';
            },
            
            addEventListeners() {
                document.getElementById('saveDayBtn').addEventListener('click', () => this.saveCurrentState());
                document.getElementById('prevDayBtn').addEventListener('click', () => this.navigateDays(-1));
                document.getElementById('nextDayBtn').addEventListener('click', () => this.navigateDays(1));
            },

            navigateDays(direction) {
                this.displayedDate.setDate(this.displayedDate.getDate() + direction);
                this.loadDayData(this.getDateString(this.displayedDate));
            },

            async saveCurrentState() {
                const dateString = this.getDateString(this.displayedDate);
                if (!this.currentUser) {
                    alert("Sess√£o expirada. Por favor, fa√ßa login novamente.");
                    return false;
                }

                const dayData = {
                    plan: {
                        dailyFocus: document.getElementById('dailyFocus').value.trim(),
                        criticalTasks: document.getElementById('criticalTasks').value.trim(),
                    },
                    review: {
                        mainAchievement: document.getElementById('mainAchievement').value.trim(),
                        mainChallenge: document.getElementById('mainChallenge').value.trim(),
                    },
                    lastUpdated: new Date().toISOString()
                };
                
                try {
                    // CAMINHO ADAPTADO PARA AS REGRAS FORNECIDAS
                    const dataRef = database.ref(`easy_lists/${this.currentUser.uid}/diario_de_bordo/${dateString}`);
                    await dataRef.set(dayData);
                    alert('Dia salvo com sucesso!');
                    this.data[dateString] = dayData;
                    return true;
                } catch (error) {
                    console.error("Erro ao salvar no Firebase:", error);
                    alert("N√£o foi poss√≠vel salvar os dados. A permiss√£o foi negada. Verifique as regras de seguran√ßa do banco de dados.");
                    return false;
                }
            },
        };

        App.init();
    });
    </script>
</body>
</html>
