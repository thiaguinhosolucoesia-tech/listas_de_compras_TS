<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Di√°rio de Bordo Din√¢mico</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --primary-color: #2c3e50; /* Azul Marinho Corporativo */
            --accent-color: #3498db; /* Azul Brilhante para A√ß√µes */
            --dark-color: #222;
            --light-color: #f4f6f8; /* Fundo geral */
            --gray-color: #7f8c8d;
            --white-color: #ffffff;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --border-color: #dfe4ea;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-headings: 'Lato', var(--font-main);
        }
        @keyframes pulse { 50% { opacity: .5; } }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; }
        body { font-family: var(--font-main); background-color: var(--light-color); color: var(--dark-color); line-height: 1.6; }
        
        .main-container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }

        #auth-container { display: none; align-items: center; justify-content: center; height: 100vh; text-align: center; }
        .auth-box { background: var(--white-color); padding: 40px; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
        .auth-box h1 { color: var(--danger-color); }
        .auth-box p { color: var(--gray-color); margin-top: 10px; }

        #app-header { background: var(--white-color); padding: 15px 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .header-left { display: flex; align-items: center; gap: 20px; }
        .back-btn { background-color: var(--light-color); color: var(--primary-color); text-decoration: none; padding: 8px 15px; border-radius: 8px; font-weight: 600; display: flex; align-items: center; gap: 5px; transition: background-color 0.2s; }
        .back-btn:hover { background-color: #e0e5e9; }
        #app-header h1 { color: var(--primary-color); font-size: 1.8em; margin: 0; }
        #user-info { display: flex; align-items: center; gap: 15px; }
        #user-email { color: var(--gray-color); font-size: 0.9em; font-weight: 500; }
        #logout-btn { background: var(--danger-color); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: 600; }

        #loader-container { display: block; }
        .skeleton { background-color: #e0e0e0; border-radius: 8px; animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .skeleton-header { height: 74px; margin-bottom: 20px; }
        .skeleton-nav { height: 40px; width: 300px; margin: 0 auto 25px auto;}
        .skeleton-box { min-height: 450px; }

        .daily-wrapper { display: grid; grid-template-columns: 1fr; gap: 30px; }
        @media (min-width: 900px) { .daily-wrapper { grid-template-columns: 1fr 1fr; } }
        header.date-header { text-align: center; margin-bottom: 25px; }
        .date-navigation { display: flex; align-items: center; justify-content: center; gap: 15px; }
        .nav-btn { background: none; border: none; font-size: 2.2em; cursor: pointer; color: var(--primary-color); padding: 0 10px; }
        #currentDate { font-size: 1.3em; color: var(--primary-color); font-weight: 600; }
        .section-box { border: 1px solid var(--border-color); border-radius: 12px; padding: 25px; background-color: var(--white-color); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .section-box h2 { font-family: var(--font-headings); font-size: 1.6em; color: var(--primary-color); border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; }
        .form-section { margin-bottom: 20px; }
        .form-section label { display: block; font-weight: 600; margin-bottom: 8px; color: #444; }
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1em; }
        textarea { resize: vertical; min-height: 100px; }
        .button-container { text-align: center; margin-top: 25px; }
        .btn-action { background-color: var(--accent-color); color: var(--white-color); border: none; padding: 12px 25px; border-radius: 8px; font-size: 1.05em; font-weight: 600; cursor: pointer; }
        footer { text-align: center; margin-top: 40px; color: var(--gray-color); font-size: 0.9em; padding: 20px 0; }
    </style>
</head>
<body>
    <div id="auth-container">
        <div class="auth-box"><h1>Acesso Negado</h1><p>Sua sess√£o √© inv√°lida ou expirou. Por favor, retorne √† plataforma e fa√ßa login novamente.</p></div>
    </div>

    <div id="loader-container" class="main-container">
        <div class="skeleton skeleton-header"></div>
        <div class="skeleton skeleton-nav"></div>
        <div class="daily-wrapper"><div class="skeleton skeleton-box"></div><div class="skeleton skeleton-box"></div></div>
    </div>

    <div id="app-container" class="main-container" style="display: none;">
        <header id="app-header">
            <div class="header-left">
                <a href="../../dashboard.html" class="back-btn"><span>&larr;</span> Voltar</a>
                <h1>Di√°rio de Bordo</h1>
            </div>
            <div id="user-info">
                <span id="user-email"></span>
                <button id="logout-btn">Sair</button>
            </div>
        </header>

        <main>
            <header class="date-header">
                <div class="date-navigation">
                    <button id="prevDayBtn" class="nav-btn">&lt;</button>
                    <p id="currentDate"></p>
                    <button id="nextDayBtn" class="nav-btn">&gt;</button>
                </div>
            </header>
            <div id="dynamic-logbook-content">
                </div>
        </main>
        
        <div class="button-container">
            <button type="button" id="saveDayBtn" class="btn-action">Salvar Registros do Dia</button>
        </div>

        <footer><p>Desenvolvido com ü§ñ por thIAguinho Solu√ß√µes</p></footer>
    </div>

    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyAo9iVQm_BzmvNLAUxc4pGL_qp6ic4JQfo", authDomain: "listas-de-compras-ff4a3.firebaseapp.com",
        databaseURL: "https://listas-de-compras-ff4a3-default-rtdb.firebaseio.com", projectId: "listas-de-compras-ff4a3",
        storageBucket: "listas-de-compras-ff4a3.firebasestorage.app", messagingSenderId: "623752672529",
        appId: "1:623752672529:web:ba43bfdad31f050da3c8b0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    // =============== CONFIGURA√á√ÉO DO DI√ÅRIO DIN√ÇMICO ===============
    // Edite este objeto para customizar completamente seu di√°rio de bordo.
    // A interface ser√° constru√≠da a partir daqui.
    const logbookConfig = {
        layout: "grid", // "grid" ou "column"
        sections: [
            {
                id: "planning",
                title: "Planejamento e Metas",
                fields: [
                    { id: "dailyFocus", label: "Foco Principal do Dia", type: "text", placeholder: "Qual √© a tarefa mais importante de hoje?" },
                    { id: "criticalTasks", label: "Tarefas Cr√≠ticas", type: "textarea", placeholder: "Liste as 3-5 prioridades que exigem sua aten√ß√£o." }
                ]
            },
            {
                id: "execution",
                title: "Execu√ß√£o e Registro",
                fields: [
                    { id: "keyActivities", label: "Atividades Chave Realizadas", type: "textarea", placeholder: "Descreva os principais avan√ßos e a√ß√µes tomadas." },
                    { id: "keyMetrics", label: "M√©tricas Relevantes", type: "number", placeholder: "Ex: Leads gerados, Chamadas feitas, Linhas de c√≥digo..." },
                ]
            },
            {
                id: "review",
                title: "Revis√£o e Aprendizados",
                fields: [
                    { id: "mainAchievement", label: "Principal Conquista", type: "text", placeholder: "Qual foi a maior vit√≥ria de hoje?" },
                    { id: "mainChallenge", label: "Principal Desafio / Bloqueio", type: "textarea", placeholder: "O que te impediu de avan√ßar e o que voc√™ aprendeu?" }
                ]
            }
        ]
    };
    // =============================================================

    document.addEventListener('DOMContentLoaded', () => {
        const App = {
            currentUser: null,
            displayedDate: new Date(),
            today: new Date(),

            init() {
                this.today.setHours(0, 0, 0, 0);
                this.displayedDate.setHours(0, 0, 0, 0);
                this.addAuthListeners();
                this.addEventListeners();
            },

            showView(view) {
                document.getElementById('loader-container').style.display = view === 'loader' ? 'block' : 'none';
                document.getElementById('auth-container').style.display = view === 'auth' ? 'flex' : 'none';
                document.getElementById('app-container').style.display = view === 'app' ? 'none' : 'block';
            },

            addAuthListeners() {
                auth.onAuthStateChanged(user => {
                    if (user) {
                        if (!this.currentUser) {
                            this.currentUser = user;
                            document.getElementById('user-email').textContent = user.email;
                            this.renderDynamicLogbook();
                            this.loadDayData(this.getDateString(this.displayedDate));
                        }
                    } else {
                        this.currentUser = null;
                        this.showView('auth');
                    }
                });
                document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());
            },

            renderDynamicLogbook() {
                const container = document.getElementById('dynamic-logbook-content');
                container.innerHTML = '';
                const wrapper = document.createElement('div');
                wrapper.className = logbookConfig.layout === 'grid' ? 'daily-wrapper' : '';
                
                logbookConfig.sections.forEach(section => {
                    let fieldsHtml = '';
                    section.fields.forEach(field => {
                        fieldsHtml += `<div class="form-section">
                            <label for="${field.id}">${field.label}</label>`;
                        if (field.type === 'textarea') {
                            fieldsHtml += `<textarea id="${field.id}" placeholder="${field.placeholder || ''}"></textarea>`;
                        } else {
                            fieldsHtml += `<input type="${field.type}" id="${field.id}" placeholder="${field.placeholder || ''}">`;
                        }
                        fieldsHtml += `</div>`;
                    });

                    const sectionBox = document.createElement('div');
                    sectionBox.className = 'section-box';
                    sectionBox.innerHTML = `<h2>${section.title}</h2><form id="${section.id}-form">${fieldsHtml}</form>`;
                    wrapper.appendChild(sectionBox);
                });
                container.appendChild(wrapper);
            },

            getDateString: date => date.toISOString().split('T')[0],

            async loadDayData(dateString) {
                if (!this.currentUser) return;
                this.showView('loader');
                const dataRef = database.ref(`easy_lists/${this.currentUser.uid}/diario_de_bordo/${dateString}`);
                try {
                    const snapshot = await dataRef.once('value');
                    const dayData = snapshot.val();
                    this.updateUI(dateString, dayData);
                } catch (error) {
                    console.error("Erro ao carregar dados:", error);
                } finally {
                   this.showView('app');
                }
            },

            updateUI(dateString, dayData) {
                document.getElementById('currentDate').textContent = this.displayedDate.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
                document.getElementById('nextDayBtn').disabled = this.getDateString(this.displayedDate) === this.getDateString(this.today);
                
                logbookConfig.sections.forEach(section => {
                    section.fields.forEach(field => {
                        const element = document.getElementById(field.id);
                        if (element) {
                            element.value = dayData?.[section.id]?.[field.id] || '';
                        }
                    });
                });
            },
            
            addEventListeners() {
                document.getElementById('saveDayBtn').addEventListener('click', () => this.saveCurrentState());
                document.getElementById('prevDayBtn').addEventListener('click', () => this.navigateDays(-1));
                document.getElementById('nextDayBtn').addEventListener('click', () => this.navigateDays(1));
            },

            navigateDays(direction) {
                this.displayedDate.setDate(this.displayedDate.getDate() + direction);
                this.loadDayData(this.getDateString(this.displayedDate));
            },

            async saveCurrentState() {
                if (!this.currentUser) { alert("Sess√£o expirada."); return false; }

                const dayData = { lastUpdated: new Date().toISOString() };

                logbookConfig.sections.forEach(section => {
                    dayData[section.id] = {};
                    section.fields.forEach(field => {
                        const element = document.getElementById(field.id);
                        if(element) {
                           dayData[section.id][field.id] = element.value.trim();
                        }
                    });
                });
                
                try {
                    const dateString = this.getDateString(this.displayedDate);
                    const dataRef = database.ref(`easy_lists/${this.currentUser.uid}/diario_de_bordo/${dateString}`);
                    await dataRef.set(dayData);
                    alert('Registros salvos com sucesso!');
                    return true;
                } catch (error) {
                    console.error("Erro ao salvar no Firebase:", error);
                    alert("N√£o foi poss√≠vel salvar os dados. A permiss√£o foi negada.");
                    return false;
                }
            },
        };

        App.init();
    });
    </script>
</body>
</html>
